# infra_sprint1

## Kittygram:
Проект представляет собой социальную сеть для обмена фотографиями ваших кисок.
Каждой киске можно дать имя, указать год раждения, цвет и достижения которыми вы особо гордитесь.

## Как запустить:
1. Сделайте fork депозитория infra_sprint1

2. Настройте пару SHH ключей для клонирования проекта на свой сервер с Github

3. Клонируйте проект с GitHub на сервер

4. Настройка бэкенд-приложения:
   Установите зависимости из файла requirements.txt
   Выполните миграции и создайте суперюзера из директории с файлом manage.py
   Заполните актуальный для вас список ALLOWED_HOSTS
   Соберите статику бэкенд-приложения
   Скопируйте директорию static_backend/ в директорию /var/www/название_проекта/

5. Установите и настройте WSGI-сервер Gunicorn:
   Не выключая виртуальное окружение проекта, установите пакет gunicorn
   Перейдите в директорию с файлом manage.py, и запустите Gunicorn на порте 8080
   Создайте файл конфигурации юнита systemd для Gunicorn в директории /etc/systemd/system/
   Назовите его по шаблону gunicorn_название_проекта.service
   Скопируйте готовые настройки из файла infra_sprint1/infra/gunicorn_kittygram.service в файл конфигурации Gunicorn
   Замените имя пользователя (User) и рабочую дирректорию (WorkingDirectory) на свои данные и сохраните изменения
   Запустите Gunicorn и запустите Gunicorn Daemon
   
7. Настройка фронтенд-приложения:
   Находясь в директории с фронтенд-приложением, установите зависимости для него
   Из директории с фронтенд-приложением выполните команду:   npm run build
   Скопируйте статику фронтенд-приложения в директорию по умолчанию:
   ```
   sudo cp -r путь_к_директории_с_фронтенд-приложением/build/. /var/www/имя_проекта/
   ```
8. Установка и настройка веб- и прокси-сервера Nginx:
   Установите и запустите nginx
   Обновите настройки Nginx. Для этого откройте файл конфигурации веб-сервера
   ```
   sudo nano /etc/nginx/sites-enabled/default
   ```
   Если на сервере уже есть проекты, добавьте настройки для сервера kittigram из файла infra_sprint1/infra/default.
   Сохраните файл, проверьте на опечатки и перезапустите nginx

9. Настройка файрвола ufw
   ```
   sudo ufw allow 'Nginx Full'  # Открывает порты 80 и 443 для запросов http и https
   sudo ufw allow OpenSSH  # Открывает порт 22 - нужен, чтобы вы могли подключаться к серверу по SSH.
   sudo ufw enable  # Включите файрвол
   ```
10. Получение и настройка SSL-сертификата
    Находясь на сервере, установите certbot, если он ещё не установлен:
    ```
    # Установка пакетного менеджера snap.
    sudo apt install snapd
    # Установка и обновление зависимостей для пакетного менеджера snap.
    sudo snap install core; sudo snap refresh core
    # Установка пакета certbot.
    sudo snap install --classic certbot
    # Обеспечение доступа к пакету для пользователя с правами администратора.
    sudo ln -s /snap/bin/certbot /usr/bin/certbot
    ```
    Запустите certbot и получите SSL-сертификат. Для этого выполните команду:
    ```
    sudo certbot --nginx
    ```
    Далее система попросит вас указать электронную почту и ответить на несколько вопро- сов. Сделайте это.
    Следующим шагом укажите доменное имя, которое вы получили для этого проекта и для которого хотели бы активировать HTTPS:

    Проверьте конфигурацию Nginx, и если всё в порядке, перезагрузите её.
    ```
    sudo nginx -t
    sudo systemctl reload nginx
    ```

## Технологии:

Backend
* Django
* djangorestframework
* joiser
* SQLite

Frontend
* JavaScript
* React

WSGI сервер
* Gunicorn

WEB сервер
* NGINX

## Автор:
Текутьев Александр
`https://github.com/Tekut`
